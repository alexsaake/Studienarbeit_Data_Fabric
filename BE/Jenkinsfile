pipeline {
    agent any
    tools {
        maven 'autoinstalled maven'
        //dockerTool 'docker'
    }
    stages {

        stage('Version') {
            steps {
                sh 'mvn --version'
            }
        }

        stage("Compilation") {
           steps {
                dir('BE/') {
                    sh "mvn clean install -DskipTests"
                }
            }
        }
        stage("Docker Build") {
           steps {
                dir('BE/') {
                    //sh "docker build -t immofabric-pipeline-image ."
                    //app = docker.build("immofabric-pipeline-image")
                                    echo 'Starting to build docker image'

                                    script {
                                        def customImage = docker.build("immofabric-pipeline-image")
                                        customImage.push()
                                    }
                }
            }
         }
        stage("Deployment") {
           steps {
                dir('BE/') {
                    //sh "docker stop immofabric-pipeline-container"
                    sh "docker run  --name immofabric-pipeline-container -d -p 8443:8443 immofabric-pipeline-image"
                }
            }
         }
    }
}


